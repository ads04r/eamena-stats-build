---
toc: false
---
# E34N31-32

```js

const grid_data = await FileAttachment("data/grids/E34N31-32.json").json();

function summarise(item)
{
	var intret = {}
	var ret = []
	for(var i=0; i < item.length; i++)
	{
		for(var j=0; j < item[i].Tiles.length; j++)
		{
			const kv = item[i].Tiles[j];
			const k = kv[0];
			const v = parseInt(kv[1]);
			if(!(k in intret)) { intret[k] = 0; }
			intret[k] = intret[k] + v;
		}
	}
	for (const [key, value] of Object.entries(intret))
	{
		ret.push({'label': key, 'records': value})
	}
	console.log(ret);
	return ret;
}

function role_expand(role)
{
	if(role.constructor.name == "Array")
	{
		var ret = Array();
		for(var i = 0; i < role.length; i++)
		{
			ret.push(role[i].label);
		}
		return ret.join(', ');
	}
	return role.label;
}

const site_sel = view(Inputs.table(grid_data, {
        columns: ['Label', 'Role', 'Date', 'Tiles', 'ID'],
        header: {'Label': 'EAMENA ID', 'Date': 'Assessment Date(s)', 'Tiles': 'Assessments', 'ID': ''},
        format: {
                'ID': (x) => htl.html`<a href="https://database.eamena.org/report/${ x }">EAMENA Link</a>`,
                'Role': (x) => htl.html`${ role_expand(x) }`,
		'Tiles': (x) => htl.html`${ x.length }`,
        },
  }));

const roles = summarise(site_sel);

```

  <div class="card">${
    resize((width) => Plot.plot({
        label: "Resource Instance Components",
        marginLeft: 250,
        marginRight: 30,
        width: width,
        x: { axis: null },
        y: { axis: null },
        marks: [
                Plot.barX(roles, {
                        x: "records",
                        y: "label",
                        color: { legend: false },
                        fill: "label",
                        sort: { y: "x", reverse: true, limit: 10 }
                }),
                Plot.text(roles, {
                        text: d => `${Math.floor(d.records / 1000)} K`,
                        x: "records",
                        y: "label",
                        textAnchor: "start",
                        dx: 3,
                        fill: "white"
                }),
                Plot.text(roles, {
                        text: d => d.label,
                        textAnchor: "end",
                        x: 0,
                        y: "label",
                        dx: -3,
                        fill: "white"
                })
        ]
    }))
  }</div>
