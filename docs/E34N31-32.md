---
toc: false
---
# E34N31-32

```js

function selected_sites(table)
{
        var ret = []

        var id = role_sel.filter((d) => d.year === year_sel);
        var role_id = id[0].role.id;
        var year = id[0].year;
        for(var i = 0; i < table.length; i++)
        {
                for (var j = 0; j < grid_data[table[i]['label']].length; j++)
                {
                        var item = grid_data[table[i]['label']][j];
                        var id = item['ID'];
                        var label = item['Label'];

                        var role = item['Role'];
                        var roles = [];
                        if(Array.isArray(role))
                        {
                                roles = role;
                        } else {
                                if(typeof role !== 'undefined')
                                {
                                        roles.push(role);
                                }
                        }
                        var ct = 0;
                        for(var k = 0; k < roles.length; k++)
                        {
                                if(roles[k].id == role_id) { ct++; }
                        }
                        if(ct == 0) { continue; }

                        var date = item['Date'];
                        var dates = [];
                        if(Array.isArray(date))
                        {
                                dates = date;
                        } else {
                                if(typeof date !== 'undefined')
                                {
                                        dates.push(date);
                                }
                        }
                        var ct = 0;
                        for(var k = 0; k < dates.length; k++)
                        {
                                if(dates[k].substr(0, 4) == year) { ct++; }
                        }
                        if(ct == 0) { continue; }

                        ret.push(item);
                }
        }
        return ret
}

const grid_data = await FileAttachment("data/grids/E34N31-32.json").json();

function role_expand(role)
{
	if(role.constructor.name == "Array")
	{
		var ret = Array();
		for(var i = 0; i < role.length; i++)
		{
			ret.push(role[i].label);
		}
		return ret.join(', ');
	}
	return role.label;
}

const site_sel = view(Inputs.table(grid_data, {
        columns: ['Label', 'Role', 'Date', 'Tiles', 'ID'],
        header: {'Label': 'EAMENA ID', 'Date': 'Assessment Date(s)', 'Tiles': 'Assessments', 'ID': ''},
        format: {
                'ID': (x) => htl.html`<a href="https://database.eamena.org/report/${ x }">EAMENA Link</a>`,
                'Role': (x) => htl.html`${ role_expand(x) }`,
		'Tiles': (x) => htl.html`${ x.length }`,
        },
  }));

```


<div class="grid grid-cols-3">
  <div class="card">
	<p> Total sites </p>
	<h2> </h2>
  </div>
  <div class="card">
  </div>
  <div class="card">
  </div>
</div>

```js

JSON.stringify(selected_sites(site_sel));

```
